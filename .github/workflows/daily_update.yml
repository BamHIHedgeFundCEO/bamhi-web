name: BamHI Daily Data Update ğŸš€

# è¨­å®šè§¸ç™¼æ™‚æ©Ÿ
on:
  # 1. å®šæ™‚åŸ·è¡Œ (Schedule)
  schedule:
    # é€™æ˜¯ UTC æ™‚é–“ 22:00 = å°ç£æ™‚é–“ æ—©ä¸Š 06:00
    # (ç¾è‚¡æ”¶ç›¤æ˜¯å°ç£å‡Œæ™¨ 04:00/05:00ï¼Œæ‰€ä»¥ 06:00 æŠ“è³‡æ–™æœ€ä¿éšª)
    - cron: '0 22 * * *'
  
  # 2. æ‰‹å‹•åŸ·è¡Œ (è®“ä½ åœ¨ç¶²é ä¸Šä¹Ÿå¯ä»¥æŒ‰æŒ‰éˆ•å¼·åˆ¶æ›´æ–°)
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    # çµ¦äºˆæ©Ÿå™¨äººå¯«å…¥æ¬Šé™ (é‡è¦ï¼)
    permissions:
      contents: write

    steps:
      # 1. æŠŠç¨‹å¼ç¢¼æŠ“ä¸‹ä¾†
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      # 3. å®‰è£éœ€è¦çš„å¥—ä»¶
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas yfinance plotly requests streamlit pandas_datareader

      # 4. åŸ·è¡Œä½ çš„ã€Œä¸­å¤®å»šæˆ¿ã€è…³æœ¬ (åšä¾¿ç•¶)
      - name: Run Data Pipeline
        run: python update_data.py

      # 5. æŠŠæ–°çš„ CSV æª”ä¸Šå‚³å› Github
      - name: Commit and push changes
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git add data/*.csv
          # å¦‚æœæœ‰è³‡æ–™æ›´æ–°æ‰ commitï¼Œæ²’æ›´æ–°å°±ä¸åšå‹•ä½œ (é¿å…å ±éŒ¯)
          git commit -m "ğŸ“ˆ Auto-update market data [skip ci]" || exit 0
          git push